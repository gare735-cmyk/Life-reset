<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Life Reset Prototype</title>
  <style>
    :root{--gap:14px;--radius:14px}
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Apple SD Gothic Neo,Helvetica,Arial,"Noto Sans KR",sans-serif; margin:0; background:#0f1221; color:#f2f6ff}
    header{padding:20px; background:linear-gradient(120deg,#2a2f5a,#151936); position:sticky; top:0; z-index:2; border-bottom:1px solid #2b2f53}
    h1{font-size:20px; margin:0 0 8px 0; display:flex; align-items:center; gap:8px}
    h1 .logo{font-size:22px}
    .levelbar{display:flex; align-items:center; gap:10px}
    .bar{flex:1; height:10px; background:#1b2040; border-radius:99px; overflow:hidden; box-shadow:inset 0 0 0 1px #2b2f53}
    .fill{height:100%; background:linear-gradient(90deg,#5bd6ff,#60ffa4); width:0%}
    .meta{font-size:12px; opacity:.9}
    main{padding:18px}
    .card{background:#171a33; border:1px solid #282d54; border-radius:var(--radius); padding:14px; margin-bottom:var(--gap); box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    input,select,button,textarea{border-radius:10px; border:1px solid #2b2f53; background:#0f1433; color:#e7edff; padding:10px 12px; font-size:14px}
    button{background:#2b7fff; border:0; cursor:pointer}
    button.ghost{background:#171a33; border:1px solid #2b2f53}
    button:disabled{opacity:.5; cursor:not-allowed}
    .goal{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px; border-radius:12px; border:1px solid #2b2f53; background:#11152f; margin-bottom:10px}
    .goal .title{font-weight:600}
    .goal .tags{font-size:12px; opacity:.8}
    .goal.done{opacity:.65}
    .badges{display:flex; gap:8px; flex-wrap:wrap}
    .badge{padding:8px 10px; border-radius:999px; border:1px solid #2b2f53; background:#11152f; font-size:13px}
    .empty{opacity:.7; font-size:14px; text-align:center; padding:16px}
    .toast{position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:#0e5234; color:#d8ffef; padding:10px 14px; border-radius:999px; border:1px solid #237d59; display:none; z-index:5}
    .grid{display:grid; grid-template-columns:1fr; gap:var(--gap)}
    @media(min-width:850px){ .grid{grid-template-columns: 1.2fr 1fr} }
    .pill{font-size:11px; opacity:.85; border:1px solid #2b2f53; padding:4px 8px; border-radius:999px; background:#171a33}
    .danger{background:#721d32; border-color:#a63253}
    .success{background:#1b5533; border-color:#2a8a56}
    a{color:#86afff}
    .small{font-size:12px; opacity:.85}
  </style>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Life Reset">
<link rel="apple-touch-icon" href="icon.png">

</head>
<body>
<header>
  <h1><span class="logo">ğŸ®</span> Life Reset <span class="pill" id="todayPill"></span></h1>
  <div class="levelbar">
    <div class="bar"><div id="xpFill" class="fill"></div></div>
    <div class="meta" id="xpMeta">Lv 1 Â· 0 / 100 XP</div>
  </div>
</header>

<main>
  <div class="grid">
    <section>
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px">
          <h2 style="margin:0;font-size:16px">ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸</h2>
          <div class="small" id="summary"></div>
        </div>
        <div id="todayList"></div>
        <div class="empty" id="emptyToday" style="display:none">ì˜¤ëŠ˜ í•  í€˜ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ëª©í‘œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ë‚´ì¼ ë‹¤ì‹œ ë„ì „í•´ìš”!</div>
      </div>

      <div class="card">
        <h2 style="margin:0 0 10px 0; font-size:16px">ëª©í‘œ ì¶”ê°€</h2>
        <div class="row">
          <input id="goalTitle" placeholder="ì˜ˆ: 30ë¶„ ëŸ¬ë‹ / 1ê³¼ ì‚¬ìš´ë”©" style="flex:2">
          <select id="goalType" style="flex:1">
            <option value="habit">ìŠµê´€(ì•„ë¬´ ë•Œë‚˜)</option>
            <option value="daily">ë°ì¼ë¦¬(í•˜ë£¨ 1íšŒ)</option>
            <option value="oneoff">ì¼íšŒì„±</option>
          </select>
          <select id="goalDiff" style="flex:1">
            <option value="1">ë‚œì´ë„ â˜…</option>
            <option value="2">ë‚œì´ë„ â˜…â˜…</option>
            <option value="3">ë‚œì´ë„ â˜…â˜…â˜…</option>
          </select>
          <button onclick="addGoal()">ì¶”ê°€</button>
        </div>
        <div class="small" style="margin-top:8px; opacity:.8">ì™„ë£Œ ì‹œ íšë“ XP = 10 Ã— ë‚œì´ë„. ì¼íšŒì„±ì€ ë³´ë„ˆìŠ¤ 2ë°°.</div>
        <div id="allList" style="margin-top:12px"></div>
      </div>
    </section>

    <aside>
      <div class="card">
        <h2 style="margin:0 0 10px 0; font-size:16px">ë°°ì§€</h2>
        <div class="badges" id="badges"></div>
        <div class="empty" id="emptyBadges" style="display:none">ì•„ì§ ë°°ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì—°ì† ë„ì „ìœ¼ë¡œ ë°°ì§€ë¥¼ íšë“í•˜ì„¸ìš”!</div>
      </div>

      <div class="card">
        <h2 style="margin:0 0 10px 0; font-size:16px">ë°ì´í„°</h2>
        <div class="row">
          <button class="ghost" onclick="exportData()">ë°±ì—…(Export)</button>
          <button class="ghost" onclick="importData()">ë³µì›(Import)</button>
          <button class="ghost danger" onclick="resetAll()">í•˜ë“œ ë¦¬ì…‹</button>
        </div>
        <p class="small" style="margin-top:8px">ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì˜ <b>ë¡œì»¬ ì €ì¥ì†Œ</b>ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œëŠ” ë™ê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
      </div>

      <div class="card">
        <h2 style="margin:0 0 10px 0; font-size:16px">ì‚¬ìš© íŒ</h2>
        <ul class="small" style="margin:0 0 0 18px; line-height:1.6">
          <li>ì•„ì´í° Safariì—ì„œ ì´ íŒŒì¼ì„ ì—´ê³  ê³µìœ ë²„íŠ¼ â†’ í™ˆ í™”ë©´ì— ì¶”ê°€ë¡œ ì•±ì²˜ëŸ¼ ì‚¬ìš©.</li>
          <li>GitHub Pagesì— ì—…ë¡œë“œí•˜ë©´ ì–´ë””ì„œë‚˜ ì ‘ì† ê°€ëŠ¥.</li>
          <li>ìŠµê´€/ë°ì¼ë¦¬ëŠ” í•˜ë£¨ì— í•œ ë²ˆë§Œ XPê°€ ì§€ê¸‰ë©ë‹ˆë‹¤.</li>
        </ul>
      </div>
    </aside>
  </div>
</main>

<div class="toast" id="toast"></div>

<script>
  // ---------- Utilities ----------
  const dayStr = (d=new Date()) => {
    const tzOffset = d.getTimezoneOffset() * 60000;
    const local = new Date(d - tzOffset);
    return local.toISOString().slice(0,10);
  };
  const yesterdayStr = () => {
    const d = new Date(); d.setDate(d.getDate()-1); return dayStr(d);
  };
  const uid = () => Math.random().toString(36).slice(2,9);

  const xpForLevel = (lvl) => 100 * (lvl*lvl);      // lvl 1->100, 2->400, 3->900...
  const levelFromXP = (xp) => Math.max(1, Math.floor(Math.sqrt(xp/100)) || 1);

  function toast(msg){
    const el = document.getElementById('toast');
    el.textContent = msg; el.style.display='block';
    setTimeout(()=> el.style.display='none', 1800);
  }

  // ---------- State ----------
  const defaultState = {
    createdAt: dayStr(),
    xp: 0,
    goals: [], // {id,title,type,difficulty,streak,lastDone,completed}
    badges: [] // {id,title,emoji,earnedAt}
  };
  let state = load();

  function save(){ localStorage.setItem('lifeReset', JSON.stringify(state)); }
  function load(){
    try{
      const s = JSON.parse(localStorage.getItem('lifeReset'));
      return s ? s : structuredClone(defaultState);
    }catch(e){ return structuredClone(defaultState); }
  }

  // ---------- Badge Logic ----------
  const hasBadge = (id) => state.badges.some(b=>b.id===id);
  function awardBadge(id,title,emoji){
    if (!hasBadge(id)){
      state.badges.push({id,title,emoji,earnedAt: dayStr()});
      toast(`ë°°ì§€ íšë“! ${emoji} ${title}`);
    }
  }
  function checkBadges(){
    const total = state.goals.length;
    if (total >= 3) awardBadge('starter','ì²« ëª©í‘œ 3ê°œ ì„¤ì •','ğŸ¯');
    if (state.xp >= 100) awardBadge('xp100','100 XP ë‹¬ì„±','ğŸ’ ');
    if (state.xp >= 500) awardBadge('xp500','500 XP ë‹¬ì„±','ğŸ”·');
    if (state.xp >= 1000) awardBadge('xp1000','1000 XP ë‹¬ì„±','ğŸ’');

    state.goals.forEach(g=>{
      if (g.streak >= 3) awardBadge('streak3','3ì¼ ì—°ì†','ğŸ”¥');
      if (g.streak >= 7) awardBadge('streak7','7ì¼ ì—°ì†','âš¡ï¸');
      if (g.streak >= 30) awardBadge('streak30','30ì¼ ì—°ì†','ğŸ†');
    });
  }

  // ---------- XP + Done ----------
  function completeGoal(id){
    const g = state.goals.find(x=>x.id===id);
    if (!g) return;
    const today = dayStr();
    const yest = yesterdayStr();
    const base = 10 * (g.difficulty||1);
    if (g.type === 'oneoff'){
      if (g.completed){ toast('ì´ë¯¸ ì™„ë£Œëœ ì¼íšŒì„± ëª©í‘œì…ë‹ˆë‹¤.'); return; }
      state.xp += base * 2;
      g.completed = true;
      g.lastDone = today;
      g.streak = (g.streak||0) + 1;
      toast(`+${base*2} XP! ì¼íšŒì„± ì™„ë£Œ ğŸ‰`);
    }else{
      if (g.lastDone === today){ toast('ì˜¤ëŠ˜ì€ ì´ë¯¸ ì™„ë£Œí–ˆì–´ìš”.'); return; }
      state.xp += base;
      if (g.lastDone === yest) g.streak = (g.streak||0) + 1; else g.streak = 1;
      g.lastDone = today;
      toast(`+${base} XP! ì˜í–ˆì–´ìš” âœ…`);
    }
    save(); checkBadges(); render();
  }

  // ---------- CRUD Goals ----------
  function addGoal(){
    const title = document.getElementById('goalTitle').value.trim();
    const type = document.getElementById('goalType').value;
    const difficulty = parseInt(document.getElementById('goalDiff').value,10);
    if (!title){ toast('ëª©í‘œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
    state.goals.push({id:uid(), title, type, difficulty, streak:0, lastDone:null, completed:false});
    document.getElementById('goalTitle').value='';
    save(); checkBadges(); render();
  }
  function removeGoal(id){
    if (confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”? ì§„í–‰ ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')){
      state.goals = state.goals.filter(g=>g.id!==id);
      save(); render();
    }
  }

  // ---------- Export / Import ----------
  function exportData(){
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `life-reset-backup-${Date.now()}.json`; a.click();
    URL.revokeObjectURL(url);
  }
  function importData(){
    const input = document.createElement('input');
    input.type = 'file'; input.accept = 'application/json';
    input.onchange = (e)=>{
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const s = JSON.parse(reader.result);
          if (!s || !('xp' in s) || !('goals' in s)) throw new Error('invalid');
          state = s; save(); render(); toast('ë³µì› ì™„ë£Œ!');
        }catch(err){ alert('ë°±ì—… íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
      };
      reader.readAsText(file);
    };
    input.click();
  }
  function resetAll(){
    if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')){
      state = structuredClone(defaultState);
      save(); render(); toast('ì´ˆê¸°í™” ì™„ë£Œ');
    }
  }

  // ---------- Render ----------
  function render(){
    // Header
    const lvl = levelFromXP(state.xp);
    const curBase = xpForLevel(lvl);
    const nextBase = xpForLevel(lvl+1);
    const curInLevel = state.xp - curBase;
    const need = nextBase - curBase;
    const pct = Math.max(0, Math.min(100, Math.round((curInLevel/need)*100)));
    document.getElementById('xpFill').style.width = pct + '%';
    document.getElementById('xpMeta').textContent = `Lv ${lvl} Â· ${Math.max(0,curInLevel)} / ${need} XP`;

    document.getElementById('todayPill').textContent = `ì˜¤ëŠ˜ Â· ${dayStr()}`;

    // Today list
    const today = dayStr();
    const todayGoals = state.goals.filter(g=>{
      if (g.type==='oneoff') return !g.completed; // show if not done
      return g.lastDone !== today; // show if not done yet today
    });
    const todayList = document.getElementById('todayList');
    todayList.innerHTML='';
    if (todayGoals.length===0){ document.getElementById('emptyToday').style.display='block'; }
    else { document.getElementById('emptyToday').style.display='none'; }
    todayGoals.forEach(g=> todayList.appendChild(goalItem(g,true)));

    // All list
    const allList = document.getElementById('allList'); allList.innerHTML='';
    state.goals.forEach(g=> allList.appendChild(goalItem(g,false)));

    // Summary
    const total = state.goals.length;
    const left = todayGoals.length;
    document.getElementById('summary').textContent = `ì´ ${total}ê°œ Â· ë‚¨ì€ ${left}ê°œ`;

    // Badges
    const b = document.getElementById('badges'); b.innerHTML='';
    if (!state.badges.length) document.getElementById('emptyBadges').style.display='block';
    else document.getElementById('emptyBadges').style.display='none';
    state.badges.forEach(x=>{
      const el = document.createElement('div');
      el.className='badge';
      el.textContent = `${x.emoji} ${x.title}`;
      b.appendChild(el);
    });
  }

  function goalItem(g, showDoneBtn){
    const el = document.createElement('div');
    const isDoneToday = (g.lastDone === dayStr()) || (g.type==='oneoff' && g.completed);
    el.className = 'goal' + (isDoneToday ? ' done':'');
    const tags = `${(g.type==='habit'?'ìŠµê´€':g.type==='daily'?'ë°ì¼ë¦¬':'ì¼íšŒì„±')} Â· â˜…${g.difficulty} Â· ì—°ì† ${g.streak||0}ì¼`;
    el.innerHTML = `
      <div style="min-width:0; flex:1">
        <div class="title">${escapeHTML(g.title)}</div>
        <div class="tags">${tags}</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        ${showDoneBtn? `<button ${isDoneToday?'disabled':''} onclick="completeGoal('${g.id}')">${isDoneToday?'ì™„ë£Œë¨':'ì™„ë£Œ'}</button>`:''}
        <button class="ghost" onclick="removeGoal('${g.id}')">ì‚­ì œ</button>
      </div>
    `;
    return el;
  }

  function escapeHTML(str){
    return str.replace(/[&<>"']/g, m=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  // init
  checkBadges(); render();
</script>
</body>
</html>